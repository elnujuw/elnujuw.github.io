<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Odoo14开发者指南第六章-管理模块数据【翻译】 - Junle&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Junle&#039;s Blog"><meta name="msapplication-TileImage" content="/static/logos.jpeg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Junle&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="在第四章《应用模型》中，我们看到了如何在自定义模块中声明或扩展业务模型。那一章涵盖了计算字段的编写方法，以及约束字段的方法。本章重点介绍Odoo方法定义、记录集操作和扩展继承方法的服务器端开发基础知识。有了这个，您将能够在Odoo模块中添加&amp;#x2F;修改业务逻辑。"><meta property="og:type" content="blog"><meta property="og:title" content="Odoo14开发者指南第六章-管理模块数据【翻译】"><meta property="og:url" content="https://www.junle.org/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E5%85%AD%E7%AB%A0-%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/"><meta property="og:site_name" content="Junle&#039;s Blog"><meta property="og:description" content="在第四章《应用模型》中，我们看到了如何在自定义模块中声明或扩展业务模型。那一章涵盖了计算字段的编写方法，以及约束字段的方法。本章重点介绍Odoo方法定义、记录集操作和扩展继承方法的服务器端开发基础知识。有了这个，您将能够在Odoo模块中添加&amp;#x2F;修改业务逻辑。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.junle.org/images/Menu_to_open_a_records_metadata.png"><meta property="article:published_time" content="2022-06-16T02:01:36.000Z"><meta property="article:modified_time" content="2024-03-22T06:43:55.677Z"><meta property="article:author" content="Junle"><meta property="article:tag" content="Odoo开发者指南"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://www.junle.org/images/Menu_to_open_a_records_metadata.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.junle.org/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E5%85%AD%E7%AB%A0-%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/"},"headline":"Odoo14开发者指南第六章-管理模块数据【翻译】","image":["https://www.junle.org/images/Menu_to_open_a_records_metadata.png"],"datePublished":"2022-06-16T02:01:36.000Z","dateModified":"2024-03-22T06:43:55.677Z","author":{"@type":"Person","name":"Junle"},"publisher":{"@type":"Organization","name":"Junle's Blog","logo":{"@type":"ImageObject","url":"https://www.junle.org/static/logos.jpeg"}},"description":"在第四章《应用模型》中，我们看到了如何在自定义模块中声明或扩展业务模型。那一章涵盖了计算字段的编写方法，以及约束字段的方法。本章重点介绍Odoo方法定义、记录集操作和扩展继承方法的服务器端开发基础知识。有了这个，您将能够在Odoo模块中添加&#x2F;修改业务逻辑。"}</script><link rel="canonical" href="https://www.junle.org/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E5%85%AD%E7%AB%A0-%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/"><link rel="alternate" href="/atom.xml" title="Junle&#039;s Blog" type="application/atom+xml"><link rel="icon" href="/static/logos.jpeg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/monokai-sublime.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/static/logos.jpeg" alt="Junle&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/tags">标签</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-06-16T02:01:36.000Z" title="2022/6/16 10:01:36">2022-06-16</time>发表</span><span class="level-item"><time dateTime="2024-03-22T06:43:55.677Z" title="2024/3/22 14:43:55">2024-03-22</time>更新</span><span class="level-item">1 小时读完 (大约8043个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Odoo14开发者指南第六章-管理模块数据【翻译】</h1><div class="content"><p>在本章中，我们将了解如何在安装附加模块时提供数据。在提供默认值、添加元数据（例如视图描述、菜单或操作）时对我们很有用。另一个重要的用途是提供演示数据，选中<strong>加载演示数据</strong> 复选框后，在创建数据库时加载演示数据。</p>
<p>在本章中，我们将介绍以下内容：</p>
<ul>
<li><p><a href="#%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8ID%E5%92%8C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4">使用外部ID和命名空间</a></p>
</li>
<li><p><a href="#%E4%BD%BF%E7%94%A8XML%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE">使用XML文件加载数据</a></p>
</li>
<li><p><a href="#%E4%BD%BF%E7%94%A8noupdate%E5%92%8Cforcecreate%E6%A0%87%E5%BF%97">使用<strong>noupdate</strong> 和<strong>forcecreate</strong> 标志</a></p>
</li>
<li><p><a href="#%E4%BD%BF%E7%94%A8CSV%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE">使用CSV文件加载数据</a></p>
</li>
<li><p><a href="#%E9%99%84%E5%8A%A0%E6%9B%B4%E6%96%B0%E5%92%8C%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB">附加更新和数据迁移</a></p>
</li>
<li><p><a href="#%E4%BB%8EXML%E6%96%87%E4%BB%B6%E4%B8%AD%E5%88%A0%E9%99%A4%E8%AE%B0%E5%BD%95">从XML文件中删除记录</a></p>
</li>
<li><p><a href="#%E4%BB%8EXML%E6%96%87%E4%BB%B6%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0">从XML文件调用函数</a></p>
</li>
</ul>
<span id="more"></span>


<h2 id="技术要求"><a href="#技术要求" class="headerlink" title="技术要求"></a>技术要求</h2><p>本章的技术要求包括在线的Odoo平台。</p>
<p>本章中使用的所有代码都可以从以下GitHub存储库下载：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/PacktPublishing/Odoo-14-Development-Cookbook-Fourth-Edition/tree/master/Chapter06">https://github.com/PacktPublishing/Odoo-14-Development-Cookbook-Fourth-Edition/tree/master/Chapter06</a></p>
<p>为了避免重复大量代码，我们将使用<a href="/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%BA%94%E7%94%A8%E6%A8%A1%E5%9E%8B%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/">第四章《应用模型》</a>中定义的模型。要遵循这些示例，请确保从<strong>Chapter04&#x2F;r6_hierarchy_model&#x2F;my_library</strong> 获取<strong>my_library</strong> 模块的代码。</p>
<h2 id="使用外部ID和命名空间"><a href="#使用外部ID和命名空间" class="headerlink" title="使用外部ID和命名空间"></a>使用外部ID和命名空间</h2><p>Odoo中的外部ID或XML ID用于识别记录。到目前为止，在本书中，我们已经在视图、菜单和操作等领域使用了XML ID。但是，我们还没有看到XML ID的真正含义。本节会让你有更深入的了解。</p>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>我们将写入已经存在的记录来演示如何使用跨模块引用：</p>
<ol>
<li><p>更新<strong>my_library</strong> 模块的清单文件注册数据文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;data&#x27;</span>: [</span><br><span class="line">    <span class="string">&#x27;data/data.xml&#x27;</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>library.book</strong> 模型中创建一本新书：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;book_cookbook&quot;</span> <span class="attr">model</span>=<span class="string">&quot;library.book&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span> Odoo 14 Development Cookbook <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>更改主公司名称：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;base.main_company&quot;</span> <span class="attr">model</span>=<span class="string">&quot;res.company&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Packt publishing<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>安装模块以应用更改。安装后将创建新的书籍记录<em>Odoo 14 Development Cookbook</em> ，公司将更名为<strong>Packt publishing</strong> 。</p>
<h3 id="运行原理"><a href="#运行原理" class="headerlink" title="运行原理"></a>运行原理</h3><p>XML ID是引用数据库中记录的字符串。ID本身是<strong>ir.model.data</strong> 模型的记录。该模型包含声明XML ID的模块名称、ID字符串、引用模型和引用ID等数据。</p>
<p>每次我们在<strong>&lt;record&gt;</strong> 标签上使用XML ID时，Odoo都会检查字符串是否已命名空间（即它是否正好包含一个点），如果没有，它会将使用当前模块名称作为命名空间。 然后，它会查找<strong>ir.model.data</strong> 中是否已经存在具有指定名称的记录。如果存在，则执行列出字段的<strong>UPDATE</strong> 语句； 如果不存在，则执行<strong>CREATE</strong> 语句。这是在记录已经存在时提供部分数据的方式，就像我们之前所做的那样。</p>
<p>在章的第一个示例中，记录的ID为<strong>book_cookbook</strong> 。由于它还没有命名，因此最终的外部ID将具有这样的模块名称：<strong>my_library.book_cookbook</strong> 。然后Odoo将尝试查找<strong>my_library.book_cookbook</strong> 的记录。 由于Odoo还没有该外部ID的记录，它将在<strong>library.book</strong> 模型中生成新记录。</p>
<p>在第二个示例中，我们使用了主公司的外部ID，即<strong>base.main_company</strong>。正如其命名空间所暗示的，它是从基本模块加载的。由于外部ID已经存在，而不是创建记录，Odoo将执行<strong>write(UPDATE)</strong> 操作更新公司名为<strong>Packt publishing</strong> 。</p>
<blockquote>
<p><strong>重要笔记</strong><br>除了更改其他模块定义的记录外，部分数据的广泛应用是使用快捷方式元素以方便的方式创建记录并在该记录上写入字段，快捷方式元素不支持：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">act_window</span> <span class="attr">id</span>=<span class="string">&quot;my_action&quot;</span> <span class="attr">name</span>=<span class="string">&quot;My action&quot;</span> <span class="attr">model</span>=<span class="string">&quot;res.partner&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;my_action&quot;</span> <span class="attr">model</span>=<span class="string">&quot;ir.actions.act_window&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;auto_search&quot;</span> <span class="attr">eval</span>=<span class="string">&quot;False&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>在本章的<a href="#%E4%BD%BF%E7%94%A8XML%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE">使用XML文件加载数据</a>一节中使用的<strong>ref</strong> 函数也会在适当的情况下将当前模块添加为命名空间，但如果生成的XML ID不存在，则会引发错误。如果它还没有命名空间，这也适用于id属性。</p>
<blockquote>
<p><strong>提示</strong><br>如果您想查看所有外部标识符的列表，请激活开发者模式并打开菜单到<strong>Settings | Technical | Sequence &amp; Identifiers | External<br>Identifiers</strong> 。</p>
</blockquote>
<h3 id="扩展内容"><a href="#扩展内容" class="headerlink" title="扩展内容"></a>扩展内容</h3><p>您可能迟早需要通过Python代码访问具有XML ID的记录。在这些情况下使用<strong>self.env.ref()</strong> 函数。这将返回被引用记录的浏览记录（记录集）。请注意，在这里，您始终必须传递完整的XML ID。下面是一个完整的XML ID示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">module_name</span>&gt;</span>.<span class="tag">&lt;<span class="name">record_id</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>您可以从用户界面查看任何记录的XML ID。为此您需要在Odoo中激活开发者模式。请参阅<a href="/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E4%B8%80%E7%AB%A0-%E5%AE%89%E8%A3%85Odoo%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/#%E6%BF%80%E6%B4%BBOdoo%E5%BC%80%E5%8F%91%E8%80%85%E6%A8%A1%E5%BC%8F%E5%B7%A5%E5%85%B7">第一章《安装Odoo开发环境》</a>激活开发者模式。激活开发人员模式后，打开要查找其XML ID的记录的表单视图。您将在顶部栏中看到一个bug图标。从该菜单中，单击<strong>View Metadata</strong> 选项。请参阅以下屏幕截图以供参考：</p>
<p>   <img src="/images/Menu_to_open_a_records_metadata.png" alt="打开记录元数据的菜单"></p>
<blockquote>
<p><strong>也可以看看</strong><br>请参阅本章的<a href="#%E4%BD%BF%E7%94%A8noupdate%E5%92%8Cforcecreate%E6%A0%87%E5%BF%97">使用noupdate和forcecreate标志</a>章节，了解为什么公司名称仅在模块安装期间更改。</p>
</blockquote>
<h2 id="使用XML文件加载数据"><a href="#使用XML文件加载数据" class="headerlink" title="使用XML文件加载数据"></a>使用XML文件加载数据</h2><p>在前面的章节中，我们使用外部标识符<strong>book_cookbook</strong> 创建了新的图书记录。在本节中，我们将从XML文件中添加不同类型的数据。我们将添加一本书和一位作者作为演示数据。我们还将在我们的模块中添加一个知名出版社作为常规数据。</p>
<h3 id="实现步骤-1"><a href="#实现步骤-1" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>按照给定的步骤创建两个数据XML文件并将它们注册到您的<strong>__manifest__.py</strong> 文件中：</p>
<ol>
<li><p>在<strong>demo</strong> 中将名为<strong>data&#x2F;demo.xml</strong> 的文件添加到清单中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;demo&#x27;</span>: [</span><br><span class="line">    <span class="string">&#x27;data/demo.xml&#x27;</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
</li>
<li><p>将以下内容添加到该文件中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">odoo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;author_pga&quot;</span> <span class="attr">model</span>=<span class="string">&quot;res.partner&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Parth Gajjar<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;author_af&quot;</span> <span class="attr">model</span>=<span class="string">&quot;res.partner&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Alexandre Fayolle<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;author_dr&quot;</span> <span class="attr">model</span>=<span class="string">&quot;res.partner&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Daniel Reis<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;author_hb&quot;</span> <span class="attr">model</span>=<span class="string">&quot;res.partner&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Holger Brunn<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;book_cookbook&quot;</span> <span class="attr">model</span>=<span class="string">&quot;library.book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Odoo Cookbook<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;short_name&quot;</span>&gt;</span>cookbook<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;date_release&quot;</span>&gt;</span>2016-03-01<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;author_ids&quot;</span> <span class="attr">eval</span>=<span class="string">&quot;[(6, 0, [ref(&#x27;author_af&#x27;), ref(&#x27;author_dr&#x27;), ref(&#x27;author_hb&#x27;)])]&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;publisher_id&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;res_partner_packt&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">odoo</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>data</strong> 部分中将名为<strong>data&#x2F;data.xml</strong> 的文件添加到清单中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;data&#x27;</span>: [</span><br><span class="line">    <span class="string">&#x27;data/data.xml&#x27;</span>,</span><br><span class="line">    ...</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
</li>
<li><p>将以下XML内容添加到<strong>data&#x2F;data.xml</strong> 文件中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">odoo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;res_partner_packt&quot;</span> <span class="attr">model</span>=<span class="string">&quot;res.partner&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Packt Publishing<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span>&gt;</span>Birmingham<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;country_id&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;base.uk&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">odoo</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>当你现在更新了你的模块，你会看到我们创建的出版社，如果你的数据库启用了演示数据，如<a href="/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%88%9B%E5%BB%BAOdoo%E9%99%84%E5%8A%A0%E6%A8%A1%E5%9D%97%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/">第三章《创建Odoo附加模块》</a>中所指出的，你还会找到这本书及其作者。</p>
<h3 id="运行原理-1"><a href="#运行原理-1" class="headerlink" title="运行原理"></a>运行原理</h3><p>数据XML文件使用<strong>&lt;record&gt;</strong> 标签在数据库表中创建一行记录。<strong>&lt;record&gt;</strong> 标签有两个强制属性，<strong>id</strong> 和<strong>model</strong> 。对于<strong>id</strong> 属性，请参阅<a href="#%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8ID%E5%92%8C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4">使用外部ID和命名空间</a>章节；<strong>model</strong> 属性是指模型的<strong>_name</strong> 属性。然后，我们使用<strong>&lt;field&gt;</strong> 元素填充数据库中的列，由您命名的模型定义。该模型还决定必须填写哪些字段并定义默认值。在这种情况下，您不需要显式地为这些字段赋值。</p>
<p>有两种方法可以在模块清单中注册数据XML文件。一个带有<strong>data</strong> 键，第二个带有<strong>demo</strong> 键。每次安装或更新模块时都会加载<strong>data</strong> 键中的XML文件。仅当您为数据库启用演示数据时，才会加载带有<strong>demo</strong> 键的XML文件。</p>
<p>在第1步中，我们在清单中使用<strong>demo</strong> 注册了一个<strong>data</strong> XML文件。因为我们使用的是<strong>demo</strong> 键，所以只有在您为数据库启用了演示数据时才会加载XML文件。</p>
<p>在第2步中，在标量值的情况下，<strong>&lt;field&gt;</strong> 元素可以包含作为简单文本的值。如果您需要传递文件的内容（例如设置图像），请使用<strong>&lt;field&gt;</strong> 元素上的文件属性并传递相对于附加组件路径的文件名。</p>
<p>对于设置引用有两种方法。 最简单的是使用<strong>ref</strong> 属性，它适用于<strong>many2one</strong> 字段，并且只包含要引用的记录的XML ID。对于<strong>one2many</strong> 和 <strong>many2many</strong> 字段，我们需要使用<strong>eval</strong> 属性。这是一个通用属性，可用于运行Python代码来作为字段的值；例如使用<strong>strftime(‘%Y-01-01’)</strong> 来填充<strong>date</strong> 字段。<strong>X2many</strong> 字段应使用三个元素元组列表来填充，其中元组的第一个值决定要执行的操作。 在<strong>eval</strong> 属性中，我们可以访问一个名为<strong>ref</strong> 的函数，该函数返回以字符串传入的XML ID对应的数据库ID。这允许我们在不知道其具体ID的情况下引用记录，这在不同的数据库中可能不同，如下所示：</p>
<ul>
<li><p><strong>(2, id, False)</strong> ：这将从数据库中删除带有<strong>id</strong> 的关联记录。 元组的第三个元素被忽略。</p>
</li>
<li><p><strong>(3, id, False)</strong> ：取消带有<strong>id</strong> 的记录的从<strong>one2many</strong> 关联。请注意，此操作不会删除记录，它只是将现有记录保持原样。 元组的最后一个元素也被忽略。</p>
</li>
<li><p><strong>(4, id, False)</strong> ：添加一个记录与<strong>id</strong> 的记录的关联，并且元组的最后一个元素被忽略。这是最常使用到的，通常会使用<strong>ref</strong> 函数来获取由其XML ID已知的记录的数据库ID。</p>
</li>
<li><p><strong>(5, False, False)</strong> ：它会切断所有关联，但仍保持所关联的记录的完整性。</p>
</li>
<li><p><strong>(6, False, [id,...])</strong> ：这会清除当前引用的记录，以将它们替换为ID列表中的记录。元组的第二个元素被忽略。</p>
</li>
</ul>
<p>在第3步和第4步与第1步和第2步相同，仅使用<strong>data</strong> 键替换了<strong>demo</strong> 键，这意味着每次安装或升级模块时都会加载XML文件。</p>
<blockquote>
<p><strong>重要笔记</strong><br>请注意，数据文件中的顺序是很重要的，并且数据文件中的记录只能引用列表中较早的数据文件中定义的记录。这就是为什么您应该始终检查您的模块是否安装在空数据库中的原因，因为在开发过程中，您经常会在各处添加记录，这是因为之后定义的记录已经在早期更新的数据库中。<br>演示数据总是在<strong>data</strong> 键的文件之后加载，这就是本示例中的引用可生效的原因。</p>
</blockquote>
<h3 id="扩展内容-1"><a href="#扩展内容-1" class="headerlink" title="扩展内容"></a>扩展内容</h3><p>虽然您基本上可以使用记录元素做任何事情，但有一些快捷元素可以让开发人员更方便地创建某些类型的记录。其中包括菜单项、模板和动作窗口。有关这些信息，请参阅第九章《后端视图》和第十四章《CMS网站开发》。</p>
<p>字段元素还可以包含函数元素，它调用模型上定义的函数来提供字段的值。请参阅<a href="#%E4%BB%8EXML%E6%96%87%E4%BB%B6%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0">从XML文件调用函数</a>章节，在该章节里，我们只需调用一个函数直接写入数据库，绕过加载机制。</p>
<p>前面的列表缺少<strong>0</strong> 和<strong>1</strong> 的条目，因为它们在加载数据时不是很有用。为了完整起见，它们输入如下：</p>
<ul>
<li><p><strong>(0, False, {&#39;key&#39;: value})</strong> ：这将创建引用模型的新记录，其字段从位置<strong>3</strong> 的字典中填充。元组的第二个元素被忽略。由于这些记录没有XML ID，并且每次更新模块时都会运行，从而导致重复条目，因此最好避免这种情况。相反，在它自己的记录元素中创建记录，并按照本节的工作原理部分中的说明关联它。</p>
</li>
<li><p><strong>(1, id, {&#39;key&#39;: value})</strong> ：这可用于写入已关联的记录。出于我们前面提到的相同原因，您应该在XML文件中避免使用这种语法。</p>
</li>
</ul>
<p>这些语法与我们在<a href="/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%9F%BA%E6%9C%AC%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/#%E5%88%9B%E5%BB%BA%E6%96%B0%E8%AE%B0%E5%BD%95">第五章《基本服务器端开发》</a>中的<em>创建新记录</em> 和<em>更新记录集记录的值</em> 中解释的语法相同。</p>
<h2 id="使用noupdate和forcecreate标志"><a href="#使用noupdate和forcecreate标志" class="headerlink" title="使用noupdate和forcecreate标志"></a>使用noupdate和forcecreate标志</h2><p>大多数附加模块具有不同类型的数据。有些数据只需要存在模块才能正常工作，其他数据不应该由用户更改，并且大多数数据可以根据用户的需要更改并且只是为了方便而提供。本节将详细说明如何处理不同的类型。首先，我们将在已经存在的记录中写入一个字段，然后我们将创建一个应该在模块更新期间重新创建的记录。</p>
<h3 id="实现步骤-2"><a href="#实现步骤-2" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>通过在<strong>&lt;odoo&gt;</strong> 标签或<strong>&lt;record&gt;</strong> 标签上设置某些属性，我们可以在加载数据时强制执行不同的行为：</p>
<ol>
<li><p>添加将在安装时创建但不会在后续更新中更新的发布者。但是，如果用户删除它，它将被重新创建：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">odoo</span> <span class="attr">noupdate</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;res_partner_packt&quot;</span> <span class="attr">model</span>=<span class="string">&quot;res.partner&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Packt publishing<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span>&gt;</span>Birmingham<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;country_id&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;base.uk&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">odoo</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加图书类别，它在附加更新期间不会更改，如果用户删除它也不会重新创建：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">odoo</span> <span class="attr">noupdate</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;book_category_all&quot;</span> <span class="attr">model</span>=<span class="string">&quot;library.book.category&quot;</span> <span class="attr">forcecreate</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>All books<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">odoo</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="运行原理-2"><a href="#运行原理-2" class="headerlink" title="运行原理"></a>运行原理</h3><p><strong>&lt;odoo&gt;</strong> 标签可以有一个<strong>noupdate</strong> 属性，该属性会传递到第一次读取包含的数据记录时创建的<strong>ir.model.data</strong> 记录，从而最终成为该表中的一列。</p>
<p>当<strong>Odoo</strong> 安装一个插件（称为<strong>init</strong> 模式）时，所有记录都会被写入，无论<strong>noupdate</strong> 是<strong>True</strong> 还是<strong>False</strong> 。当您更新附加组件（称为<strong>update</strong> 模式）时，会检查现有XML ID以查看它们是否设置了<strong>noupdate</strong> 标志，如果是，则忽略尝试写入此XML ID的元素。如果有问题的记录被用户删除，则情况并非如此，这就是为什么您可以通过将记录上的<strong>forcecreate</strong> 标志设置为<strong>false</strong> 来强制在更新模式下不重新创建<strong>noupdate</strong> 记录。</p>
<blockquote>
<p><strong>重要笔记</strong><br>在旧版附加组件（包括8.0和之前的版本）中，您经常会发现一个<strong>&lt;openerp&gt;</strong> 元素包含一个<strong>&lt;data&gt;</strong> 元素，该元素包含<strong>&lt;record&gt;</strong> 和其他元素。这仍然是可能的，但已弃用。现在，<strong>&lt;odoo&gt;</strong> 、<strong>&lt;openerp&gt;</strong> 和<strong>&lt;data&gt;</strong> 具有完全相同的语义； 它们是用来括起XML数据的括号。</p>
</blockquote>
<h3 id="扩展内容-2"><a href="#扩展内容-2" class="headerlink" title="扩展内容"></a>扩展内容</h3><p>如果您想使用<strong>noupdate</strong> 标志加载记录，您可以使用<strong>--init&#x3D;your_addon</strong> 或<strong>-i your_addon</strong> 参数运行Odoo服务器。这将迫使Odoo重新加载您的记录。这也将导致重新创建已删除的记录。请注意，如果模块绕过XML ID机制，例如通过在<strong>&lt;function&gt;</strong> 标签调用的Python代码中创建记录，这可能会导致重复记录和相关的安装错误。</p>
<p>使用此代码，您可以绕过任何<strong>noupdate</strong> 标志，但首先，请确保这确实是您想要的。解决此处介绍的场景的另一个选项是编写迁移脚本，在<a href="#%E9%99%84%E5%8A%A0%E6%9B%B4%E6%96%B0%E5%92%8C%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB">附加更新和数据迁移</a>章节中进行详细介绍。</p>
<blockquote>
<p><strong>也可看看</strong><br>Odoo还使用XML ID来跟踪插件更新后要删除的数据。如果记录在更新之前具有来自模块命名空间的XML ID，但在更新期间未恢复XML ID，则该记录及其XML ID将从数据库中删除，因为它们被认为已过时。有关此机制的深入讨论，请参阅<a href="#%E9%99%84%E5%8A%A0%E6%9B%B4%E6%96%B0%E5%92%8C%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB">附加更新和数据迁移</a>章节。</p>
</blockquote>
<h2 id="使用CSV文件加载数据"><a href="#使用CSV文件加载数据" class="headerlink" title="使用CSV文件加载数据"></a>使用CSV文件加载数据</h2><p>虽然您可以使用XML文件做任何事情，但当您需要提供大量数据时，这种格式并不是最方便的，尤其是考虑到许多人更愿意在Calc或其他电子表格软件中预处理数据。CSV格式的另一个优点是它是您使用标准导出功能时所得到的。在本节中，我们将看看导入类似表格的数据。</p>
<h3 id="实现步骤-3"><a href="#实现步骤-3" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>一般情况下<strong>access-control lists</strong>（<strong>ACLs</strong> 请参阅第十章《安全访问》）是一种通过CSV文件加载的数据：</p>
<ol>
<li><p>将<strong>security&#x2F;ir.model.access.csv</strong> 添加到您的清单的data列表中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;data&#x27;</span>: [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;security/ir.model.access.csv&#x27;</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
</li>
<li><p>在这个文件中为我们的书籍添加一个 ACL（我们已经从<a href="/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%88%9B%E5%BB%BAOdoo%E9%99%84%E5%8A%A0%E6%A8%A1%E5%9D%97%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/#%E6%B7%BB%E5%8A%A0%E8%AE%BF%E9%97%AE%E5%AE%89%E5%85%A8">第三章《创建Odoo附加模块》</a>的<em>添加访问安全</em> 中获得了一些记录）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink</span><br><span class="line">acl_library_book_user,ACL for books,model_library_book,base.group_user,1,0,0,0</span><br></pre></td></tr></table></figure></li>
</ol>
<p>至此我们拥有一个ACL允许普通用户阅读书籍记录，但不允许他们编辑、创建或删除它们。</p>
<h3 id="运行原理-3"><a href="#运行原理-3" class="headerlink" title="运行原理"></a>运行原理</h3><p>您只需将所有数据文件放入清单的data列表中。Odoo将使用文件扩展名来决定它是哪种类型的文件。CSV文件的一个特点是它们的文件名必须与要导入的模型的名称相匹配，在我们的例子中是<strong>ir.model.access</strong> 。 第一行需要是列名与模型的字段名完全匹配的标题。</p>
<p>对于标量值，您可以使用带引号的（如有必要，因为字符串本身包含引号或逗号）或不带引号的字符串。</p>
<p>当使用CSV文件编写<strong>many2one</strong> 字段时，Odoo首先尝试将列值解释为XML ID。 如果没有Odoo将当前模块名称添加为命名空间，并在<strong>ir.model.data</strong> 中查找结果。如果失败，模型的<strong>name_search</strong> 函数以列的值作为参数调用，返回的第一个结果。如果这也失败了，该行被认为是无效的并且Odoo会抛出一个错误。</p>
<blockquote>
<p><strong>重要笔记</strong><br>请注意，从CSV文件读取的数据始终为<strong>noupdate&#x3D;False</strong> ，并且没有方便的解决方法。这意味着您的附加组件的后续更新将始终覆盖用户所做的可能更改。如果您需要加载大量数据并且需要<strong>noupdate</strong> 这对您来说是个问题，请使用<strong>init</strong> 钩子加载CSV文件。</p>
</blockquote>
<h3 id="扩展内容-3"><a href="#扩展内容-3" class="headerlink" title="扩展内容"></a>扩展内容</h3><p>可以使用CSV文件导入<strong>one2many</strong> 和<strong>many2many</strong> 字段，但有点棘手。通常，您最好分别创建记录并随后使用XML文件设置关系，或者使用设置关系的第二个CSV文件。</p>
<p>如果您确实需要在同一文件中创建关联记录，请对列进行排序，以便所有标量字段位于左侧，链接模型的字段位于右侧，列标题由链接字段的名称和链接的 模型的字段，用冒号分隔：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;id&quot;,&quot;name&quot;,&quot;model_id:id&quot;,&quot;perm_read&quot;,&quot;perm_read&quot;, &quot;group_id:name&quot;</span><br><span class="line">&quot;access_library_book_user&quot;,&quot;ACL for books&quot;,&quot;model_library_book&quot;,1, &quot;my group&quot;</span><br></pre></td></tr></table></figure>

<p>这将创建一个名为<strong>my group</strong> 的组；您可以通过在右侧添加列来在组记录中写入更多字段。如果您需要关联多条记录，请重复该行并根据需要更改右侧列。鉴于Odoo使用前一行的值填充空列，因此您不需要复制所有数据，添加一行时，对想要填充值的关联模型字段以外的字段只需使用空值。</p>
<h2 id="附加更新和数据迁移"><a href="#附加更新和数据迁移" class="headerlink" title="附加更新和数据迁移"></a>附加更新和数据迁移</h2><p>您在编写附加模块时选择的数据模型可能会出现一些弱点，因此您可能需要在附加模块的生命周期中对其进行调整。为了在没有大量操作的情况下实现这一点，Odoo支持附加模块中的版本控制，并在必要时运行迁移。</p>
<h3 id="实现步骤-4"><a href="#实现步骤-4" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>假设在我们模块的早期版本中<strong>date_release</strong> 字段是一个字符字段，人们在其中写下他们认为合适的任何日期作为日期。我们现在意识到我们需要这个字段来进行比较和聚合，这就是我们想要将其类型更改为<strong>Date</strong> 的原因。</p>
<p>Odoo在类型转换方面做得很好，但是在这种情况下，我们是靠自己的，这就是为什么我们需要提供有关如何使用安装在数据库上的先前版本的模块来转换数据库的说明，其中当前版本可以运行。让我们尝试以下步骤：</p>
<ol>
<li><p>在<strong>__manifest__.py</strong> 文件中添加版本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;13.0.1.0.1&#x27;</span>,</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>migrations&#x2F;13.0.1.0.1&#x2F;pre-migrate.py</strong> 中提供预迁移代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">migrate</span>(<span class="params">cr, version</span>):</span><br><span class="line">    cr.execute(<span class="string">&#x27;ALTER TABLE library_book RENAME COLUMN date_release TO date_release_char&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>migrations&#x2F;13.0.1.0.1&#x2F;post-migrate.py</strong> 中提供迁移后代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> odoo <span class="keyword">import</span> fields</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">migrate</span>(<span class="params">cr, version</span>):</span><br><span class="line">    cr.execute(<span class="string">&#x27;SELECT id, date_release_char FROM library_book&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> record_id, old_date <span class="keyword">in</span> cr.fetchall():</span><br><span class="line">        <span class="comment"># check if the field happens to be set in Odoo&#x27;s internal format</span></span><br><span class="line">        new_date = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            new_date = fields.Date.to_date(old_date)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(old_date) == <span class="number">4</span> <span class="keyword">and</span> old_date.isdigit():</span><br><span class="line">                <span class="comment"># probably a year</span></span><br><span class="line">                new_date = date(<span class="built_in">int</span>(old_date), <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> new_date:</span><br><span class="line">            cr.execute(<span class="string">&#x27;UPDATE library_book SET date_release=%s&#x27;</span>,(new_date,))   </span><br></pre></td></tr></table></figure></li>
</ol>
<p>如果没有此代码，Odoo会将旧的<strong>date_release</strong> 列重命名为<strong>date_release_moved</strong> 并创建一个新列，因为没有从字符字段到日期字段的自动转换。从用户的角度来看，<strong>date_release</strong> 中的数据将完全消失。</p>
<h3 id="运行原理-4"><a href="#运行原理-4" class="headerlink" title="运行原理"></a>运行原理</h3><p>第一个关键点是增加附加组件的版本号，因为迁移代码仅在版本变更时运行。在每次更新期间，Odoo将更新时清单中的版本号会写入<strong>ir_module_module</strong> 表。如果版本号包含三个或更少的组件，则版本号以Odoo的主要和次要版本作为前缀。在前面的示例中，我们明确命名了Odoo的主要版本和次要版本，这是一个很好的做法，但值为<strong>1.0.1</strong> 会产生相同的效果，因为在内部，Odoo会为带有自己主要版本和次要版本号的附加组件添加版本号前缀。通常使用长符号是一个好主意，因为您可以一眼看出插件适用于哪个版本的Odoo。</p>
<p>这两个迁移文件只是代码文件，不需要在任何地方注册。更新插件时，Odoo会将插件的版本（如<strong>ir_module_module</strong> 中所述）与插件清单中的版本进行比较。如果清单的版本更高（在添加Odoo的主要和次要版本之后），将搜索此插件的迁移文件夹以查看它是否包含中间版本的文件夹，直到当前更新版本的版本号。</p>
<p>然后在找到的文件夹中名称以<strong>pre-</strong> 开头的Python文件，加载它们，并为其定义一个名为<strong>migrate</strong> 的函数，该函数有两个参数。该函数以数据库游标作为第一个参数，当前安装的版本作为第二个参数调用。这一时间在Odoo查找插件定义的其它代码之前，因此你可以假定你的数据库结构对比此前版本没有做过任何修改。</p>
<p>在所有的<strong>pre-migrate</strong> 函数运行成功后，Odoo会加载模型和插件中声明的数据，这会导致数据库布局发生变化。鉴于我们在<strong>pre-migrate.py</strong> 中重命名了<strong>date_release</strong> ，Odoo将使用该名称创建正确的数据类型一个新列。</p>
<p>之后，使用相同的搜索算法，将搜索并执行迁移后的文件。在我们的例子中，我们需要查看每一个值，看看我们是否可以从中得到一些有用的东西；否则，我们将数据保持为<strong>NULL</strong> 。如果不是绝对必要，不要编写遍历整个表的脚本；在这种情况下，我们可能会编写一个很大且可读性差的SQL的switch语句。</p>
<blockquote>
<p><strong>重要提示</strong><br>如果您只是想重命名列，则不需要迁移脚本。在这种情况下，您可以将相关字段的<strong>oldname</strong> 参数设置为该字段的原始列名，Odoo会自动更新它。</p>
</blockquote>
<h3 id="扩展内容-4"><a href="#扩展内容-4" class="headerlink" title="扩展内容"></a>扩展内容</h3><p>在迁移前和迁移后步骤中，您只能访问游标，如果您熟悉Odoo环境，这会变得不是很方便。在这个阶段使用模型可能会导致意想不到的结果，因为在预迁移步骤中，附加组件的模型尚未加载，并且在迁移后步骤中，由依赖于当前插件的插件定义的模型也尚未加载。 但是，如果这对您来说不是问题，也许是因为你想要使用你的插件所不涉及的模型或者是你已知这不会是一个问题的模型，那么就可以编写如下代码创建一个习惯的环境：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> odoo <span class="keyword">import</span> api, SUPERUSER_ID</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">migrate</span>(<span class="params">cr, version</span>):</span><br><span class="line">    env = api.Environment(cr, SUPERUSER_ID, &#123;&#125;)</span><br><span class="line">    <span class="comment"># env holds all currently loaded models</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>也可以看看</strong><br>在编写迁移脚本时，您经常会遇到重复性任务，例如检查列或表是否存在、重命名或将一些旧值映射到新值。在这里重新发明轮子是令人沮丧和容易出错的；如果您负担得起额外的依赖，请考虑使用<a target="_blank" rel="noopener" href="https://github.com/OCA/openupgradelib">https://github.com/OCA/openupgradelib</a>。</p>
</blockquote>
<h2 id="从XML文件中删除记录"><a href="#从XML文件中删除记录" class="headerlink" title="从XML文件中删除记录"></a>从XML文件中删除记录</h2><p>在前面的章节中，我们看到了如何从XML文件创建或更新记录。有时，您希望从依赖模块中删除以前创建的记录。这可以通过<strong>&lt;delete&gt;</strong> 标签来完成。</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>在本节中，我们将从XML文件中添加一些类别，后删除它们。在实际情况下，您将从另一个模块创建此记录。但为简单起见，我们将在同一个XML文件中添加一些类别，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;book_category_to_delete&quot;</span> <span class="attr">model</span>=<span class="string">&quot;library.book.category&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Test Category<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">record</span> <span class="attr">id</span>=<span class="string">&quot;book_category_not_delete&quot;</span> <span class="attr">model</span>=<span class="string">&quot;library.book.category&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span>Test Category 2<span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">record</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="实现步骤-5"><a href="#实现步骤-5" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>有两种方法可以从XML文件中删除记录：</p>
<ul>
<li><p>使用先前创建的记录的XML ID：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">model</span>=<span class="string">&quot;library.book.category&quot;</span> <span class="attr">id</span>=<span class="string">&quot;book_category_to_delete&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用搜索域：</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">model</span>=<span class="string">&quot;library.book.category&quot;</span> <span class="attr">search</span>=<span class="string">&quot;[(&#x27;name&#x27;, &#x27;ilike&#x27;, &#x27;Test&#x27;)]&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="运行原理-5"><a href="#运行原理-5" class="headerlink" title="运行原理"></a>运行原理</h3><p>您将需要使用<strong>&lt;delete&gt;</strong> 标签。要从模型中删除记录，您需要在模型属性中提供模型的名称。这是一个强制属性。</p>
<p>在第一种方法中，您需要提供先前从另一个模块的数据文件创建的记录的XML ID。在模块安装过程中，Odoo会尝试查找记录。如果找到给定XML ID的记录，它将删除该记录，否则将抛出错误。您只能删除从XML文件创建的记录（或具有XML ID的记录）。</p>
<p>第二种方法，需要在domain属性中传入<strong>domain</strong> 。在安装模块的过程中，Odoo会按这个domain搜索记录。如果找到记录，它将删除它们。如果没有记录与给定域匹配，则此选项不会抛出错误。使用此选项时要格外小心，因为它可能会删除用户的数据，因为搜索选项会删除与域匹配的所有记录。</p>
<blockquote>
<p><strong>警告</strong><br><strong>&lt;delete&gt;</strong> 在Odoo中很少使用，因为它很危险。如果您对此不小心，您可能会破坏系统。尽可能避免它。</p>
</blockquote>
<h2 id="从XML文件调用函数"><a href="#从XML文件调用函数" class="headerlink" title="从XML文件调用函数"></a>从XML文件调用函数</h2><p>您可以从XML文件创建所有类型的记录，但有时很难生成包含某些业务逻辑的数据。当用户在生产中安装依赖模块时，您可能希望修改记录。例如，假设您要创建一个模块来在线显示书籍。<strong>my_library</strong> 模块已经有一个<strong>image-cover</strong> 字段。 想象一下，在新模块中，您实现了减小图像大小并将其存储在新缩略图字段中的逻辑。现在，当用户安装这个模块时，他们可能已经有了书籍和图像。无法从XML文件中的<strong>&lt;record&gt;</strong> 标签生成缩略图。在这种情况下，您可以通过<strong>&lt;function&gt;</strong> 标签调用模型方法。</p>
<h3 id="实现步骤-6"><a href="#实现步骤-6" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>本节我们将使用上节中的代码。例如，我们将现有图书价格提高10美元。请注意，您可能会根据公司配置使用其他货币。</p>
<p>按照以下步骤从XML文件调用Python方法：</p>
<ol>
<li><p>在<strong>library.book</strong> 模型中添加<strong>_update_book_price()</strong> 方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.model</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_update_book_price</span>(<span class="params">self</span>):</span><br><span class="line">    all_books = self.search([])</span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> all_books:</span><br><span class="line">        book.cost_price += <span class="number">10</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在数据XML文件中添加<strong>&lt;function&gt;</strong> ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">model</span>=<span class="string">&quot;library.book&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_update_book_price&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="运行原理-6"><a href="#运行原理-6" class="headerlink" title="运行原理"></a>运行原理</h3><p>在第1步中，我们添加了<strong>_update_book_price()</strong> 方法，该方法搜索所有书籍并将价格提高10美元。 以<strong>_</strong> 开头的函数名称会被ORM认为是私有的，不能通过RPC调用。</p>
<p>在第2步中，我们使用了具有两个属性的<strong>&lt;function&gt;</strong> 标签：</p>
<ul>
<li><p><strong>model</strong> ：声明方法的模型名称</p>
</li>
<li><p><strong>name</strong> ：要调用的方法的名称</p>
</li>
</ul>
<p>当您安装此模块时，<strong>_update_book_price()</strong> 将被调用，书籍的价格将增加10美元。</p>
<blockquote>
<p><strong>重要笔记</strong><br>始终将此功能与<strong>noupdate</strong> 选项一起使用。 否则，每次更新模块时都会调用它。</p>
</blockquote>
<h3 id="扩展内容-5"><a href="#扩展内容-5" class="headerlink" title="扩展内容"></a>扩展内容</h3><p>使用<strong>&lt;function&gt;</strong> 还可以向函数传递参数。假设您只想提高特定类别书籍的价格，并且希望将该金额作为参数发送。</p>
<p>为此，您需要创建一个接受类别作为参数的方法，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@api.model</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_book_price</span>(<span class="params">self, category, amount_to_increase</span>):</span><br><span class="line">    category_books = self.search([(<span class="string">&#x27;category_id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, category.<span class="built_in">id</span>)])</span><br><span class="line">    <span class="keyword">for</span> book <span class="keyword">in</span> category_books:</span><br><span class="line">        book.cost_price += amount_to_increase</span><br></pre></td></tr></table></figure>

<p>要将类别和金额作为参数传递，需要使用<strong>eval</strong> 属性，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">function</span> <span class="attr">model</span>=<span class="string">&quot;library.book&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">name</span>=<span class="string">&quot;update_book_price&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">eval</span>=<span class="string">&quot;(ref(&#x27;category_xml_id&#x27;), 20)&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>当您安装该模块时，它会将给定类别的书籍的价格增加20美元。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Odoo14开发者指南第六章-管理模块数据【翻译】</p><p><a href="https://www.junle.org/Odoo14开发者指南第六章-管理模块数据【翻译】/">https://www.junle.org/Odoo14开发者指南第六章-管理模块数据【翻译】/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Junle</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-06-16</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2024-03-22</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Odoo%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97/">Odoo开发者指南</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/static/donate_wechat.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/Print-Spooler-%E6%9C%8D%E5%8A%A1%E6%84%8F%E5%A4%96%E7%BB%88%E6%AD%A2/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Print Spooler 服务意外终止</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%9F%BA%E6%9C%AC%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/"><span class="level-item">Odoo14开发者指南第五章-基本服务端开发【翻译】</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://www.junle.org/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E5%85%AD%E7%AB%A0-%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/';
            this.page.identifier = 'Odoo14开发者指南第六章-管理模块数据【翻译】/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'junles-blog' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/static/avatar.jpg" alt="Junle"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Junle</p><p class="is-size-6 is-block">elnujuw</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Guangdong (CN)</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">59</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">24</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/elnujuw" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/elnujuw"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/static/email.png"><i class="fas fa-at"></i></a></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-25T03:24:10.000Z">2024-03-25</time></p><p class="title"><a href="/%E5%A6%82%E4%BD%95%E5%9C%A8RuoYi-Vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%95%B4%E5%90%88%E7%A7%AF%E6%9C%A8%E6%8A%A5%E8%A1%A8/">如何在RuoYi-Vue项目中整合积木报表</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-03-22T07:56:01.000Z">2024-03-22</time></p><p class="title"><a href="/RuoYi%E7%B3%BB%E7%BB%9F%E5%A6%82%E4%BD%95%E4%B8%8ESQLServer%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E7%BE%8E%E6%90%AD%E9%85%8D/">RuoYi系统如何与SQLServer数据库完美搭配</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-24T05:34:39.000Z">2023-07-24</time></p><p class="title"><a href="/%E6%8E%92%E6%9F%A5SQL-Server%E4%B8%AD%E8%BF%90%E8%A1%8C%E7%BC%93%E6%85%A2%E7%9A%84%E6%9F%A5%E8%AF%A2%E9%97%AE%E9%A2%98/">排查SQL Server中运行缓慢的查询问题</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-12-01T01:35:51.000Z">2022-12-01</time></p><p class="title"><a href="/Print-Spooler-%E6%9C%8D%E5%8A%A1%E6%84%8F%E5%A4%96%E7%BB%88%E6%AD%A2/">Print Spooler 服务意外终止</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-06-16T02:01:36.000Z">2022-06-16</time></p><p class="title"><a href="/Odoo14%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97%E7%AC%AC%E5%85%AD%E7%AB%A0-%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E6%95%B0%E6%8D%AE%E3%80%90%E7%BF%BB%E8%AF%91%E3%80%91/">Odoo14开发者指南第六章-管理模块数据【翻译】</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">七月 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">十二月 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">十二月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">四月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">一月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">六月 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">十一月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/07/"><span class="level-start"><span class="level-item">七月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/03/"><span class="level-start"><span class="level-item">三月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/01/"><span class="level-start"><span class="level-item">一月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">七月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/11/"><span class="level-start"><span class="level-item">十一月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">八月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/06/"><span class="level-start"><span class="level-item">六月 2014</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Arduino/"><span class="tag">Arduino</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Chart-js/"><span class="tag">Chart.js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ERP5/"><span class="tag">ERP5</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ESP8266/"><span class="tag">ESP8266</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Metabase/"><span class="tag">Metabase</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odoo/"><span class="tag">Odoo</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odoo%E5%BC%80%E5%8F%91%E8%80%85%E6%8C%87%E5%8D%97/"><span class="tag">Odoo开发者指南</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenWRT/"><span class="tag">OpenWRT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PostgreSQL/"><span class="tag">PostgreSQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RaspberryPI/"><span class="tag">RaspberryPI</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RuoYi/"><span class="tag">RuoYi</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQLServer/"><span class="tag">SQLServer</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/STM32/"><span class="tag">STM32</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SlapOS/"><span class="tag">SlapOS</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Superset/"><span class="tag">Superset</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Zope/"><span class="tag">Zope</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB/"><span class="tag">工具分享</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/"><span class="tag">数据可视化</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AC%94%E8%AE%B0/"><span class="tag">笔记</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/static/logos.jpeg" alt="Junle&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Junle</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>